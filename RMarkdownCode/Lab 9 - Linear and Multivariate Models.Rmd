---
title: "Lab 9 - Linear and Multivariate Models"
output: 
html_document:
    theme: readable
    highlight: haddock
  
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir =  "/Users/GlennTattersall/Dropbox/Biometrics Labs/Lab 9 Alt - Linear and Multivariable Models")
```

___

## Lab Objectives:

- Dealing with outliers in regressions
- A t-test is a linear model
- An ANOVA is a linear model
- A regression is a linear model
- Adding variables to linear models
 
___


```{r, echo=FALSE}
setwd("~/Dropbox/Biometrics Labs/Lab 9 Alt - Linear and Multivariable Models")
```

Examine the effect on an outlier on linear regression. The data are percentage of white in the tail feathers of the dark-eyed junco at sites at different latitudes.

Read and inspect data:

```{r}
junco <- read.csv("junco.csv")
head(junco)
```

Scatter plot of all the data.

```{r}
plot(percentWhiteTail ~ latitude, data = junco)
```

```{r car}
juncoRegression <- lm(percentWhiteTail ~ latitude, data = junco)
oldpar<-par()
par(mfrow=c(1,2))
plot(juncoRegression)
```


From the diagnostic plots, it is apparent that one data point is influence.  See the 4th plot above, where one point has an elevated "Cook's distance".

The cook’s distance for each observation i measures the change in Ŷ (fitted Y) for all observations with and without the presence of observation i, so we know how much the observation i impacted the fitted values.  
Mathematically, cook’s distance Di for observation i is computed as:

In general use, those observations that have a cook’s distance greater than 4 times the mean cook's distances may be classified as influential. This is not a hard boundary.

Alternatively you can calculate the Cook's distance from the regression fit:

```{r}
cooksd<-cooks.distance(juncoRegression)
plot(cooksd, pch="*", cex=2, main="Influential Obs by Cooks distance")
abline(h = 4*mean(cooksd, na.rm=T), col="red") 
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=T),names(cooksd),""), col="red")
```

Knowing that one of the data points is influential, it could be removed.

Let's add regression lines to this scatter plot, calculated both with and without the outlier. You may need to redraw the scatter plot using the above commands before executing the following functions.  The two lines below demonstrate the influence of including (red) and removing (black) the influential point:

```{r}
plot(percentWhiteTail ~ latitude, data = junco, pch = 16, col="firebrick", 
     las = 1, cex = 1.5, bty = "l", xlab = "Latitude (degrees N)", 
     ylab = "Percent white in tail")
juncoRegression <- lm(percentWhiteTail ~ latitude, data = junco)
abline(juncoRegression, col = "red", lwd = 2)
juncoRegressionNoOut <- lm(percentWhiteTail ~ latitude, 
                           data = junco, subset = percentWhiteTail > 38)
abline(juncoRegressionNoOut, lwd = 2)
```


# Figure 17.5-4 (right). <a href="../wp-content/data/chapter17/chap17f5_4CockroachNeurons.csv">Cockroach neurons
# Make a residual plot to check assumptions. The data are temperature and the
# firing rate of neurons in cockroach.
# Read and inspect the data.

```{r}
roach <- read.csv("roach.csv")
```
Scatter plot with regression line.

```{r}
plot(rate ~ temperature, data = roach)
roachRegression <- lm(rate ~ temperature, data = roach)
abline(roachRegression)
```

Residual plot.

```{r}
plot(residuals(roachRegression) ~ temperature, data = roach)
abline(c(0,0))
```

Commands for a more elaborate residual plot are here.

```{r}
plot(residuals(roachRegression) ~ temperature, data = roach, 
     pch = 16, col = "firebrick", las = 1, cex = 1.5, bty = "l", 
     xlab = "Temperature", ylab = "Residuals")
abline(c(0,0))
```
